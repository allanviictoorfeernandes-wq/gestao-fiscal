<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaxFlow Pro v2.0 | Enterprise Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0f172a;
            --accent: #2563eb;
            --accent-soft: #eff6ff;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-app: #f8fafc;
            --sidebar-bg: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --radius: 12px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg-app); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; }

        /* Sidebar */
        aside {
            width: 280px; background: var(--sidebar-bg); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 2rem 1.2rem;
        }

        .logo { font-weight: 800; font-size: 1.4rem; color: var(--accent); margin-bottom: 2.5rem; padding-left: 0.8rem; }
        
        .nav-group { flex: 1; }
        .nav-item {
            display: flex; align-items: center; gap: 12px; padding: 0.8rem 1rem;
            border-radius: var(--radius); color: var(--text-muted); text-decoration: none;
            font-weight: 500; margin-bottom: 0.4rem; transition: 0.2s; cursor: pointer;
        }
        .nav-item:hover { background: #f1f5f9; color: var(--primary); }
        .nav-item.active { background: var(--accent-soft); color: var(--accent); }

        /* Content Area */
        main { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        
        header {
            background: #fff; padding: 1.2rem 2.5rem; border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
        }

        .view-section { display: none; flex-direction: column; height: 100%; overflow-y: auto; padding: 2rem 2.5rem; animation: fadeIn 0.3s ease; }
        .view-section.active { display: flex; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Kanban Specifics */
        .kanban-grid { display: flex; gap: 1.5rem; align-items: flex-start; }
        .column { min-width: 300px; width: 300px; background: #f1f5f9; border-radius: 16px; padding: 1rem; }
        .column-header { padding: 0.5rem 0.5rem 1.5rem; font-weight: 700; font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; display: flex; justify-content: space-between; }
        
        .dropzone { min-height: 500px; }
        .card {
            background: #fff; border-radius: var(--radius); padding: 1.2rem; margin-bottom: 1rem;
            box-shadow: var(--shadow); cursor: grab; border: 1px solid transparent; transition: 0.2s;
            position: relative;
        }
        .card:hover { border-color: var(--accent); transform: translateY(-2px); }
        .card-tag { font-size: 0.6rem; font-weight: 800; padding: 3px 8px; border-radius: 4px; background: #f1f5f9; margin-bottom: 0.8rem; display: inline-block; }
        .card-val { font-weight: 700; font-size: 1rem; margin-top: 0.8rem; display: block; }
        
        .btn-del { position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: #cbd5e1; cursor: pointer; opacity: 0; transition: 0.2s; }
        .card:hover .btn-del { opacity: 1; }
        .btn-del:hover { color: var(--danger); }

        /* Report View (Dashboard) */
        .grid-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 2.5rem; }
        .metric-card { background: #fff; padding: 1.5rem; border-radius: 16px; border: 1px solid var(--border); }
        .metric-card span { font-size: 0.8rem; color: var(--text-muted); font-weight: 600; }
        .metric-card h3 { font-size: 1.8rem; margin-top: 0.5rem; }

        .chart-container { background: #fff; padding: 2rem; border-radius: 16px; border: 1px solid var(--border); }
        .bar-row { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
        .bar-label { width: 100px; font-size: 0.8rem; font-weight: 600; }
        .bar-track { flex: 1; height: 12px; background: #f1f5f9; border-radius: 6px; overflow: hidden; }
        .bar-fill { height: 100%; background: var(--accent); transition: width 1s ease; }

        /* Common Components */
        .btn-prime { background: var(--accent); color: white; border: none; padding: 0.7rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer; }
        
        /* Modal */
        #modal { display: none; position: fixed; inset: 0; background: rgba(15,23,42,0.6); backdrop-filter: blur(4px); z-index: 100; justify-content: center; align-items: center; }
        .modal-box { background: #fff; padding: 2.5rem; border-radius: 20px; width: 450px; }
        .input-group { margin-bottom: 1.2rem; }
        label { display: block; font-size: 0.75rem; font-weight: 700; margin-bottom: 0.5rem; color: var(--text-muted); }
        input, select { width: 100%; padding: 0.8rem; border: 1px solid var(--border); border-radius: 8px; outline: none; }
        
    </style>
</head>
<body>

    <aside>
        <div class="logo">TaxFlow 2.0</div>
        <nav class="nav-group">
            <div class="nav-item active" onclick="switchView('kanban', this)"><span>üìã</span> Quadro Kanban</div>
            <div class="nav-item" onclick="switchView('list', this)"><span>üìë</span> Obriga√ß√µes</div>
            <div class="nav-item" onclick="switchView('reports', this)"><span>üìä</span> Relat√≥rios BI</div>
            <div class="nav-item" onclick="switchView('config', this)"><span>‚öôÔ∏è</span> Configura√ß√µes</div>
        </nav>
    </aside>

    <main>
        <header>
            <h2 id="view-title">Quadro Fiscal</h2>
            <button class="btn-prime" onclick="openModal()">+ Nova Guia</button>
        </header>

        <section id="view-kanban" class="view-section active">
            <div class="kanban-grid">
                <div class="column"><div class="column-header">Pendente <span id="c1">0</span></div><div class="dropzone" id="todo" ondrop="drop(event)" ondragover="allowDrop(event)"></div></div>
                <div class="column"><div class="column-header">An√°lise <span id="c2">0</span></div><div class="dropzone" id="review" ondrop="drop(event)" ondragover="allowDrop(event)"></div></div>
                <div class="column"><div class="column-header">Pagamento <span id="c3">0</span></div><div class="dropzone" id="pay" ondrop="drop(event)" ondragover="allowDrop(event)"></div></div>
                <div class="column"><div class="column-header">Conclu√≠do <span id="c4">0</span></div><div class="dropzone" id="done" ondrop="drop(event)" ondragover="allowDrop(event)"></div></div>
            </div>
        </section>

        <section id="view-list" class="view-section">
            <table style="width: 100%; border-collapse: collapse; background: #fff; border-radius: 12px; overflow: hidden;">
                <thead style="background: #f8fafc; text-align: left;">
                    <tr>
                        <th style="padding: 1rem;">Obriga√ß√£o</th>
                        <th style="padding: 1rem;">Data</th>
                        <th style="padding: 1rem;">Valor</th>
                        <th style="padding: 1rem;">Status</th>
                    </tr>
                </thead>
                <tbody id="list-body"></tbody>
            </table>
        </section>

        <section id="view-reports" class="view-section">
            <div class="grid-stats">
                <div class="metric-card"><span>TOTAL EM ABERTO</span><h3 id="stat-value">R$ 0,00</h3></div>
                <div class="metric-card"><span>TAXA DE CONCLUS√ÉO</span><h3 id="stat-rate">0%</h3></div>
                <div class="metric-card"><span>GUIAS VENCIDAS</span><h3 id="stat-expired" style="color: var(--danger)">0</h3></div>
            </div>
            <div class="chart-container">
                <h4 style="margin-bottom: 1.5rem">Distribui√ß√£o por Categoria</h4>
                <div id="chart-bars"></div>
            </div>
        </section>

        <section id="view-config" class="view-section">
            <div style="max-width: 500px; background: #fff; padding: 2rem; border-radius: 16px; border: 1px solid var(--border);">
                <h3>Prefer√™ncias do Sistema</h3>
                <div class="input-group" style="margin-top: 1.5rem">
                    <label>Nome da Empresa</label>
                    <input type="text" value="Allan Victor Consultoria Fiscal">
                </div>
                <div class="input-group">
                    <label>Moeda Padr√£o</label>
                    <select><option>BRL - Real Brasileiro</option></select>
                </div>
                <button class="btn-prime">Salvar Altera√ß√µes</button>
            </div>
        </section>
    </main>

    <div id="modal">
        <div class="modal-box">
            <h3>Nova Guia Fiscal</h3>
            <form id="taxForm" style="margin-top: 1.5rem">
                <div class="input-group"><label>NOME DA OBRIGA√á√ÉO</label><input type="text" id="t" required></div>
                <div style="display: flex; gap: 1rem">
                    <div class="input-group" style="flex:1"><label>VENCIMENTO</label><input type="date" id="d" required></div>
                    <div class="input-group" style="flex:1"><label>VALOR (R$)</label><input type="number" step="0.01" id="v" required></div>
                </div>
                <div class="input-group">
                    <label>CATEGORIA</label>
                    <select id="tag"><option>ICMS</option><option>ISS</option><option>PIS</option><option>COFINS</option><option>IRPJ</option></select>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1rem">
                    <button type="button" class="btn-prime" style="background:#f1f5f9; color: #64748b" onclick="closeModal()">Cancelar</button>
                    <button type="submit" class="btn-prime" style="flex:1">Adicionar ao Quadro</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let tasks = JSON.parse(localStorage.getItem('tax_v2_db')) || [];

        function switchView(viewId, el) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.getElementById('view-' + viewId).classList.add('active');
            el.classList.add('active');
            document.getElementById('view-title').innerText = el.innerText.replace(/[^\w\s]/gi, '').trim();
            render();
        }

        function openModal() { document.getElementById('modal').style.display='flex'; }
        function closeModal() { document.getElementById('modal').style.display='none'; }

        document.getElementById('taxForm').onsubmit = (e) => {
            e.preventDefault();
            tasks.push({
                id: 'id' + Date.now(),
                title: document.getElementById('t').value,
                date: document.getElementById('d').value,
                val: parseFloat(document.getElementById('v').value),
                tag: document.getElementById('tag').value,
                status: 'todo'
            });
            localStorage.setItem('tax_v2_db', JSON.stringify(tasks));
            closeModal(); render();
        };

        function allowDrop(e) { e.preventDefault(); }
        function drag(e) { e.dataTransfer.setData("text", e.target.id); }
        function drop(e) {
            e.preventDefault();
            const id = e.dataTransfer.getData("text");
            const status = e.target.closest('.dropzone').id;
            tasks = tasks.map(t => t.id === id ? {...t, status} : t);
            localStorage.setItem('tax_v2_db', JSON.stringify(tasks));
            render();
        }

        function del(id) { 
            if(confirm('Remover esta obriga√ß√£o?')) {
                tasks = tasks.filter(t => t.id !== id);
                localStorage.setItem('tax_v2_db', JSON.stringify(tasks));
                render();
            }
        }

        function render() {
            // Render Kanban
            const lists = ['todo', 'review', 'pay', 'done'];
            lists.forEach(l => document.getElementById(l).innerHTML = '');
            
            let totalAberto = 0;
            let concluidas = 0;

            tasks.forEach(t => {
                const card = document.createElement('div');
                card.className = 'card'; card.id = t.id; card.draggable = true;
                card.ondragstart = drag;
                card.innerHTML = `<button class="btn-del" onclick="del('${t.id}')">‚úï</button>
                    <span class="card-tag">${t.tag}</span>
                    <div style="font-weight:600; font-size: 0.9rem">${t.title}</div>
                    <div style="font-size: 0.75rem; color: #94a3b8; margin-top: 4px">üìÖ ${t.date.split('-').reverse().join('/')}</div>
                    <span class="card-val">R$ ${t.val.toLocaleString('pt-BR')}</span>`;
                document.getElementById(t.status).appendChild(card);
                
                if(t.status === 'done') concluidas++; else totalAberto += t.val;
            });

            // Render List View
            const tbody = document.getElementById('list-body');
            tbody.innerHTML = tasks.map(t => `
                <tr style="border-bottom: 1px solid #f1f5f9">
                    <td style="padding: 1rem; font-weight:600">${t.title}</td>
                    <td style="padding: 1rem">${t.date}</td>
                    <td style="padding: 1rem">R$ ${t.val}</td>
                    <td style="padding: 1rem"><span class="card-tag">${t.status}</span></td>
                </tr>
            `).join('');

            // Render Stats & Charts
            document.getElementById('stat-value').innerText = totalAberto.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
            document.getElementById('stat-rate').innerText = tasks.length ? Math.round((concluidas/tasks.length)*100) + '%' : '0%';
            
            const cats = ['ICMS', 'ISS', 'PIS', 'COFINS', 'IRPJ'];
            document.getElementById('chart-bars').innerHTML = cats.map(c => {
                const count = tasks.filter(t => t.tag === c).length;
                const perc = tasks.length ? (count / tasks.length) * 100 : 0;
                return `<div class="bar-row">
                    <div class="bar-label">${c}</div>
                    <div class="bar-track"><div class="bar-fill" style="width: ${perc}%"></div></div>
                    <div style="font-size: 0.7rem; font-weight:700">${count}</div>
                </div>`;
            }).join('');

            // Counters
            lists.forEach((l, idx) => {
                document.getElementById('c'+(idx+1)).innerText = tasks.filter(t => t.status === l).length;
            });
        }

        render();
    </script>
</body>
</html>
